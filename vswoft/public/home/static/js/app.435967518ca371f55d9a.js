webpackJsonp([1],{"/7JP":function(s,a){},"8hSR":function(s,a){},"9nk7":function(s,a){},FXIP:function(s,a){},II6t:function(s,a){},Mev0:function(s,a){},NHnr:function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=t("7+uW"),i=(t("oPmM"),t("3/yV")),e=t.n(i),l=t("DAYN"),r=t.n(l),v={components:{CircleMenu:e.a,draggable:r.a},name:"App",data:function(){return{tags:"",show:!0,routeActive:"/",val:"125",drag_style:{width:"100px",height:"100px",background:"aqua",position:"absolute",right:"30px",top:0}}},created:function(){this.routeActive=this.$route.name,console.log(this.$route.name),"page"==this.$route.name&&(this.routeActive="index")},updated:function(){this.routeActive=this.$route.name},methods:{}},c={render:function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{attrs:{id:"app"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:s.show,expression:"show"}],staticClass:"mobile-menu"},[t("circle-menu",{attrs:{type:"left",number:4,btn:"",circle:"",animate:"animated rubberBand",colors:["rgb(220,220,220)","#DCDCDC","#DCDCDC","#DCDCDC","#DCDCDC"]}},[t("router-link",{staticClass:"iconfont icon-shouye1",attrs:{slot:"item_1",to:"/"},slot:"item_1"}),s._v(" "),t("router-link",{staticClass:"iconfont icon-biaoqian1",attrs:{slot:"item_2",to:"/tags"},slot:"item_2"}),s._v(" "),t("router-link",{staticClass:"iconfont icon-guidang2",attrs:{slot:"item_3",to:"/archive"},slot:"item_3"}),s._v(" "),t("router-link",{staticClass:"iconfont icon-guanyu2",attrs:{slot:"item_4",to:"/about"},slot:"item_4"})],1)],1),s._v(" "),s._m(0),s._v(" "),t("div",{staticClass:"index-container"},[t("div",{staticClass:"index-left"},[t("div",{staticClass:"nav",attrs:{id:"nav"}},[s._m(1),s._v(" "),t("div",{staticClass:"contents",attrs:{id:"nav-content"}},[t("ul",[t("li",{class:"index"==s.routeActive||"page"==s.routeActive?"active":""},[t("router-link",{attrs:{to:"/"}},[t("i",{staticClass:"iconfont icon-shouye1"}),s._v(" "),t("span",[s._v("主页")])])],1),s._v(" "),t("li",{class:"tags"==s.routeActive?"active":""},[t("router-link",{attrs:{to:"/tags"}},[t("i",{staticClass:"iconfont icon-biaoqian1"}),s._v(" "),t("span",[s._v("标签")])])],1),s._v(" "),t("li",{class:"archive"==s.routeActive?"active":""},[t("router-link",{attrs:{to:"/archive"}},[t("i",{staticClass:"iconfont icon-guidang2"}),s._v(" "),t("span",[s._v("存档")])])],1),s._v(" "),t("li",{class:"about"==s.routeActive?"active":""},[t("router-link",{attrs:{to:"/about"}},[t("i",{staticClass:"iconfont icon-guanyu2"}),s._v(" "),t("span",[s._v("关于")])])],1)])])]),s._v(" "),s._m(2),s._v(" "),s._m(3)]),s._v(" "),t("keep-alive",[s.$route.meta.keepAlive?t("router-view",{staticStyle:{"min-height":"100%"}}):s._e()],1),s._v(" "),s.$route.meta.keepAlive?s._e():t("router-view",{staticStyle:{"min-height":"100%"}})],1),s._v(" "),s._m(4)])},staticRenderFns:[function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"index-about"},[a("i",[this._v(" sometimes code， sometimes play ")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"avatar-name"},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:"http://ontzi4vtc.bkt.clouddn.com/logo.png"}})]),this._v(" "),a("div",{staticClass:"name"},[a("i",[this._v("vate hu")])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"search-field",attrs:{id:"search-field"}},[a("div",{staticClass:"search-container"},[a("div",{staticClass:"search-input"},[a("span",{attrs:{id:"esc-search"}},[a("i",{staticClass:"icon-fanhui iconfont"})]),this._v(" "),a("input",{attrs:{id:"search-input"}}),this._v(" "),a("span",{attrs:{id:"begin-search"}},[this._v("搜索")])]),this._v(" "),a("div",{staticClass:"search-result-container",attrs:{id:"search-result-container"}})])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"index-about-mobile"},[a("i",[this._v(" sometimes code， sometimes play")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("footer",{staticClass:"footer"},[a("ul",{staticClass:"list-inline text-center"},[a("li",[a("a",{attrs:{target:"_blank",href:"https://weibo.com/5979985307"}},[a("span",{staticClass:"fa-stack fa-lg"},[a("i",{staticClass:"iconfont icon-weibo"})])])]),this._v(" "),a("li",[a("a",{attrs:{target:"_blank",href:"https://github.com/vatezj"}},[a("span",{staticClass:"fa-stack fa-lg"},[a("i",{staticClass:"iconfont icon-github"})])])])]),this._v(" "),a("p",[this._v("\n      Created By\n      "),a("a",{attrs:{href:"https://www.vate.ren/"}},[this._v("vate")]),this._v(" "),a("a",{attrs:{href:"http://www.miitbeian.gov.cn",target:"_blank"}},[this._v("粤ICP备16067937号-2")])])])}]};var _=t("VU/8")(v,c,!1,function(s){t("w5OA")},null,null).exports,p=t("/ocq"),C=t("GnHP"),o=t.n(C),b=t("c2Ch"),d={name:"index",components:{vueLoading:o.a},data:function(){return{msg:"Welcome to Your Vue.js App",postLists:{}}},created:function(){this.setNewsApi()},methods:{setNewsApi:function(){var s=this;b.a.get("/post/lists","type=top&key=123456").then(function(a){s.postLists=a.post_preview_lists})}}},u={render:function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"post-preview-container",staticStyle:{"min-height":"576px"}},s._l(s.postLists,function(a){return t("div",{staticClass:"post-preview"},[t("div",{staticClass:"post-time"},[s._v(s._s(a.post_time))]),s._v(" "),t("div",{staticClass:"post-info"},[t("router-link",{attrs:{to:"/detail/"+a.post_info}},[t("h3",[s._v("\n            "+s._s(a.post_info)+"\n          ")])]),s._v(" "),t("p",[t("span",[s._v("/")]),s._v(" "),s._l(a.tags,function(a){return t("span",[t("a",{staticClass:"tag",attrs:{href:"/tags/#javascript",title:"tag.tag_name"}},[s._v(s._s(a.tag_name))]),s._v(" "),t("span",[s._v("/")])])})],2)],1)])})),s._v(" "),t("ul",{staticClass:"pager"},[t("li",{staticClass:"next"},[t("router-link",{attrs:{to:"/page/1"}},[s._v("Older Posts →")])],1)])])},staticRenderFns:[]};var m=t("VU/8")(d,u,!1,function(s){t("FXIP")},null,null).exports,f={name:"tags",data:function(){return{tags:[],msg:"Welcome to Your Vue.js App",post_preview_lists:[],tag:""}},created:function(){this.setNewsApi()},methods:{setNewsApi:function(){var s=this;b.a.get("/tags/lists","type=top&key=123456").then(function(a){s.tags=a.tags,s.tag=a.posts.tag,s.post_preview_lists=a.posts.post_preview_lists})}}},g={render:function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"tags",attrs:{id:"tag_cloud"}},s._l(s.tags,function(a){return t("span",{attrs:{title:a.tag_name,rel:"3"}},[s._v(s._s(a.tag_name))])})),s._v(" "),t("div",{staticClass:"one-tag-list"},[t("span",{staticClass:"fa fa-tag listing-seperator",attrs:{id:"centOS"}},[t("span",{staticClass:"tag-text"},[s._v(s._s(s.tag))])]),s._v(" "),s._l(s.post_preview_lists,function(a){return t("div",{staticClass:"post-preview"},[t("router-link",{attrs:{to:"/detail/"+a.post_info}},[t("h2",{staticClass:"post-title"},[s._v("\n          "+s._s(a.post_info)+"\n        ")])]),s._v(" "),t("p",{staticClass:"post-meta"})],1)})],2)])},staticRenderFns:[]};var h=t("VU/8")(f,g,!1,function(s){t("Mev0")},null,null).exports,w={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"archives-container"},[t("div",{staticClass:"one-tag-list"},[t("span",{staticClass:"fa fa-calendar-times-o listing-seperator",attrs:{id:"2018"}},[t("span",{staticClass:"tag-text"},[s._v("2018")])]),s._v(" "),t("ul",[t("li",[t("span",[s._v("08-18")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/08/18/从源码分析sentry的错误信息收集/"}},[t("span",[s._v("\n              从源码分析sentry的错误信息收集\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("06-10")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/06/10/一篇关于react历史的流水账/"}},[t("span",[s._v("\n              一篇关于react历史的流水账\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("05-29")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/05/29/十条编写优化的JavaScript代码的建议/"}},[t("span",[s._v("\n              十条编写优化的 JavaScript 代码的建议\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("05-09")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/05/09/浅谈前端中的二进制数据类型/"}},[t("span",[s._v("\n              浅谈前端中的二进制数据类型\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("04-11")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/04/11/Linux服务器初始化设置用户和ssh公私钥登陆/"}},[t("span",[s._v("\n              Linux服务器初始化设置用户和ssh公私钥登陆\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("04-11")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/04/11/dva源码解读/"}},[t("span",[s._v("\n              dva源码解读\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("04-09")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/04/09/构建利用Proxy和Reflect实现双向数据绑定的微框架/"}},[t("span",[s._v("\n              构建利用Proxy和Reflect实现双向数据绑定的微框架\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("02-11")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2018/02/11/PWA实践-serviceWorker生命周期、请求代理与通信/"}},[t("span",[s._v("\n              [PWA实践]serviceWorker生命周期、请求代理与通信\n            ")])])])])]),s._v(" "),t("div",{staticClass:"one-tag-list"},[t("span",{staticClass:"fa fa-calendar-times-o listing-seperator",attrs:{id:"2017"}},[t("span",{staticClass:"tag-text"},[s._v("2017")])]),s._v(" "),t("ul",[t("li",[t("span",[s._v("12-15")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2017/12/15/CentOS安装node8-x版本/"}},[t("span",[s._v("\n              CentOS安装node8.x版本\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("08-31")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2017/08/31/深入浏览器web渲染与优化-续/"}},[t("span",[s._v("\n              深入浏览器web渲染与优化-续\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("08-27")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2017/08/27/深入浏览器web渲染与优化/"}},[t("span",[s._v("\n              深入浏览器web渲染与优化\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("01-11")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2017/01/11/JS的静态作用域、子程序引用环境与参数传递类型/"}},[t("span",[s._v("\n              JS的静态作用域、子程序引用环境与参数传递类型\n            ")])])])])]),s._v(" "),t("div",{staticClass:"one-tag-list"},[t("span",{staticClass:"fa fa-calendar-times-o listing-seperator",attrs:{id:"2016"}},[t("span",{staticClass:"tag-text"},[s._v("2016")])]),s._v(" "),t("ul",[t("li",[t("span",[s._v("10-04")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2016/10/04/CentOS7下安装和配置redis/"}},[t("span",[s._v("\n              CentOS7下安装和配置redis\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("08-08")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2016/08/08/腾讯云北美服务器搭建ShadowSocks代理/"}},[t("span",[s._v("\n              腾讯云北美服务器搭建ShadowSocks代理\n            ")])])]),s._v(" "),t("li",[t("span",[s._v("08-03")]),s._v(" "),t("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}}),s._v(" "),t("a",{attrs:{href:"/2016/08/03/centOS7-2搭建nginx环境以及负载均衡/"}},[t("span",[s._v("\n              centOS7.2搭建nginx环境以及负载均衡\n            ")])])])])])])])}]};var k=t("VU/8")({name:"archive",data:function(){return{msg:"Welcome to Your Vue.js App"}}},w,!1,function(s){t("9nk7")},null,null).exports,y={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"post-container"},[t("div",{staticClass:"post-title"},[s._v("\n            从源码分析sentry的错误信息收集\n        ")]),s._v(" "),t("div",{staticClass:"post-meta"},[t("span",{staticClass:"attr"},[s._v("发布于：\n                "),t("span",[s._v("2018-08-18 19:23:55")])]),s._v(" "),t("span",{staticClass:"attr"},[s._v("标签：/\n\n                "),t("a",{staticClass:"tag",attrs:{href:"/tags/#javascript",title:"javascript"}},[s._v("javascript")]),s._v(" "),t("span",[s._v("/")]),s._v(" "),t("a",{staticClass:"tag",attrs:{href:"/tags/#前端监控",title:"前端监控"}},[s._v("前端监控")]),s._v(" "),t("span",[s._v("/")])]),s._v(" "),t("span",{staticClass:"attr"},[s._v("访问：\n                "),t("span",{attrs:{id:"busuanzi_value_page_pv"}})])]),s._v(" "),t("div",{staticClass:"post-content "},[t("p",[s._v("raven.js 是 sentry 为 JavaScript 错误上报提供的 JS-SDK，本篇我们基于其源代码对其原理进行分析，本篇文章只分析前端部分，对应的文件目录是\n                "),t("code",[s._v("https://github.com/getsentry/sentry-javascript/tree/master/packages/raven-js")]),s._v("。")]),s._v(" "),t("p",[s._v("首先抛出几个问题：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("raven.js 是如何收集浏览器错误信息的？")])]),s._v(" "),t("li",[t("strong",[s._v("raven.js 上报的错误信息格式是什么样的？又是如何把这些信息传给后端？支不支持合并上报？")])]),s._v(" "),t("li",[t("strong",[s._v("面包屑（breadcrumbs）是什么？raven.js 如何来收集面包屑信息？")])]),s._v(" "),t("li",[t("strong",[s._v("raven.js 如何和框架配合使用（比如 vue、react）？")])])]),s._v(" "),t("p",[s._v("在回答以上这几个问题之前，我们首先来对 raven.js 做一个宏观的分析，主要涉及其文件目录、所引用的第三方框架等。")]),s._v(" "),t("p",[s._v("raven.js 的核心文件内容并不多，其中使用了三个第三方库，放在了 vendor 文件夹下：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/moll/json-stringify-safe",target:"_blank",rel:"noopener"}},[s._v("json-stringify-safe")]),s._v("\n                    ：一个对\n                    "),t("code",[s._v("JSON.stringify")]),s._v(" 的封装，安全的 json 序列化操作函数，不会抛出循环引用的错误。\n                    "),t("ul",[t("li",[s._v("这里面有一个注意点要单独说一下，我们熟知的\n                            "),t("code",[s._v("JSON.stringify")]),s._v(" , 可以接受三个参数：第一个参数是我们要序列化的对象；第二个参数是对其中键值对的处理函数；第三个参数是控制缩进空格。reven.js 的\n                            "),t("code",[s._v("json-stringify-safe")]),s._v(" 就是充分利用了这三个参数。")])])]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/blueimp/JavaScript-MD5",target:"_blank",rel:"noopener"}},[s._v("md5")]),s._v("：js 的 md5 函数。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/csnover/TraceKit",target:"_blank",rel:"noopener"}},[s._v("TraceKit")]),s._v("：TraceKit 是一个已经比较完善的错误收集、堆栈格式化的库，reven.js 的功能在很大程度上对它有所依赖。")])]),s._v(" "),t("p",[s._v("除此之外，raven.js 支持插件，官方提供的一些知名库的 sentry 插件主要放在了 plugin 文件夹下面，raven.js 的一些核心文件，则放在了 src 文件夹下面。")]),s._v(" "),t("h3",{attrs:{id:"raven-js-是如何收集错误信息的？"}},[t("a",{staticClass:"headerlink",attrs:{href:"#raven-js-是如何收集错误信息的？",title:"raven.js 是如何收集错误信息的？"}}),s._v("raven.js 是如何收集错误信息的？\n            ")]),s._v(" "),t("p",[s._v("我们知道，在前端收集错误，肯定离不开\n                "),t("code",[s._v("window.onerror")]),s._v(" 这个函数，那么我们就从这个函数说起。")]),s._v(" "),t("p",[s._v("实际上，这部分工作是 raven.js 引用的第三方库 TraceKit 完成的：")]),s._v(" "),t("figure",{staticClass:"highlight sqf"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[s._v("function installGlobalHandler() {")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"variable"},[s._v("_onErrorHandlerInstalled")]),s._v(") { "),t("span",{staticClass:"comment"},[s._v("// 一个起到标志作用的全局变量")])]),t("br"),t("span",{staticClass:"line"},[s._v("    return;")]),t("br"),t("span",{staticClass:"line"},[s._v("  }")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"variable"},[s._v("_oldOnerrorHandler")]),s._v(" = "),t("span",{staticClass:"variable"},[s._v("_window")]),s._v(".onerror; ")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"comment"},[s._v("// _oldOnerrorHandler 是防止对用户其他地方定义的回调函数进行覆盖")])]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"comment"},[s._v("// 该 _window 经过兼容，实际上就是 window")])]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"variable"},[s._v("_window")]),s._v(".onerror = traceKitWindowOnError;")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"variable"},[s._v("_onErrorHandlerInstalled")]),s._v(" = "),t("span",{staticClass:"literal"},[s._v("true")]),s._v(";")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br")])])])])]),s._v(" "),t("p",[s._v("相关错误回调函数交给 traceKitWindowOnError 处理，下面我们来看一下 traceKitWindowOnError 函数，为了避免太多冗余代码，我们仅分析一种主要情况：")]),s._v(" "),t("figure",{staticClass:"highlight javascript"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br"),t("span",{staticClass:"line"},[s._v("11")]),t("br"),t("span",{staticClass:"line"},[s._v("12")]),t("br"),t("span",{staticClass:"line"},[s._v("13")]),t("br"),t("span",{staticClass:"line"},[s._v("14")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("traceKitWindowOnError")]),s._v("("),t("span",{staticClass:"params"},[s._v("msg, url, lineNo, colNo, ex")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("\t")]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" exception = utils.isErrorEvent(ex) ? ex.error : ex;")]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("//...")])]),t("br"),t("span",{staticClass:"line"},[s._v("    stack = TraceKit.computeStackTrace(exception);")]),t("br"),t("span",{staticClass:"line"},[s._v("    notifyHandlers(stack, "),t("span",{staticClass:"literal"},[s._v("true")]),s._v(");")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("//...")])]),t("br"),t("span",{staticClass:"line"},[s._v("   ")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("//...")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (_oldOnerrorHandler) {")]),t("br"),t("span",{staticClass:"line"},[s._v("       "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" _oldOnerrorHandler.apply("),t("span",{staticClass:"keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"built_in"},[s._v("arguments")]),s._v(");")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"literal"},[s._v("false")]),s._v(";")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br")])])])])]),s._v(" "),t("p",[s._v("其中调用的最重要的一个函数，就是 computeStackTrace，而这个函数也是 TraceKit 的核心函数，简单来讲，它做的事情就是统一格式化报错信息调用栈，因为对于各个浏览器来说，返回的 Error 调用栈信息格式不尽相同，另外甚至还有的浏览器并不返回调用栈，computeStackTrace 函数对这些情况都做了兼容性处理，并且对于一些不返回调用栈的情况，还使用了 caller 来向上回溯函数的调用栈，最终把报错信息转化成一个键相同的对象数组，做到了报错信息格式的统一。\n            ")]),s._v(" "),t("p",[s._v("notifyHandlers 函数则是通知相关的回调函数。 实际上，raven.js 在 install 函数中会调用 TraceKit.report.subscribe 函数，并把对错误的处理逻辑写入回调：")]),s._v(" "),t("figure",{staticClass:"highlight actionscript"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("subscribe")]),t("span",{staticClass:"params"},[s._v("(handler)")]),s._v(" ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    installGlobalHandler();")]),t("br"),t("span",{staticClass:"line"},[s._v("    handlers.push(handler);")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br")])])])])]),s._v(" "),t("p",[s._v("以上过程完成了错误处理过程中的负责角色转换，并且借助 TraceKit，可以使 raven.js 得到一个结构比较清晰的带有格式化好的调用栈信息的错误内容对象，之后，raven.js 对错误内容进一步处理并最终上报。")]),s._v(" "),t("p",[s._v("下面我们对错误处理 raven.js 控制的部分做了一些梳理：")]),s._v(" "),t("figure",{staticClass:"highlight javascript"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br"),t("span",{staticClass:"line"},[s._v("11")]),t("br"),t("span",{staticClass:"line"},[s._v("12")]),t("br"),t("span",{staticClass:"line"},[s._v("13")]),t("br"),t("span",{staticClass:"line"},[s._v("14")]),t("br"),t("span",{staticClass:"line"},[s._v("15")]),t("br"),t("span",{staticClass:"line"},[s._v("16")]),t("br"),t("span",{staticClass:"line"},[s._v("17")]),t("br"),t("span",{staticClass:"line"},[s._v("18")]),t("br"),t("span",{staticClass:"line"},[s._v("19")]),t("br"),t("span",{staticClass:"line"},[s._v("20")]),t("br"),t("span",{staticClass:"line"},[s._v("21")]),t("br"),t("span",{staticClass:"line"},[s._v("22")]),t("br"),t("span",{staticClass:"line"},[s._v("23")]),t("br"),t("span",{staticClass:"line"},[s._v("24")]),t("br"),t("span",{staticClass:"line"},[s._v("25")]),t("br"),t("span",{staticClass:"line"},[s._v("26")]),t("br"),t("span",{staticClass:"line"},[s._v("27")]),t("br"),t("span",{staticClass:"line"},[s._v("28")]),t("br"),t("span",{staticClass:"line"},[s._v("29")]),t("br"),t("span",{staticClass:"line"},[s._v("30")]),t("br"),t("span",{staticClass:"line"},[s._v("31")]),t("br"),t("span",{staticClass:"line"},[s._v("32")]),t("br"),t("span",{staticClass:"line"},[s._v("33")]),t("br"),t("span",{staticClass:"line"},[s._v("34")]),t("br"),t("span",{staticClass:"line"},[s._v("35")]),t("br"),t("span",{staticClass:"line"},[s._v("36")]),t("br"),t("span",{staticClass:"line"},[s._v("37")]),t("br"),t("span",{staticClass:"line"},[s._v("38")]),t("br"),t("span",{staticClass:"line"},[s._v("39")]),t("br"),t("span",{staticClass:"line"},[s._v("40")]),t("br"),t("span",{staticClass:"line"},[s._v("41")]),t("br"),t("span",{staticClass:"line"},[s._v("42")]),t("br"),t("span",{staticClass:"line"},[s._v("43")]),t("br"),t("span",{staticClass:"line"},[s._v("44")]),t("br"),t("span",{staticClass:"line"},[s._v("45")]),t("br"),t("span",{staticClass:"line"},[s._v("46")]),t("br"),t("span",{staticClass:"line"},[s._v("47")]),t("br"),t("span",{staticClass:"line"},[s._v("48")]),t("br"),t("span",{staticClass:"line"},[s._v("49")]),t("br"),t("span",{staticClass:"line"},[s._v("50")]),t("br"),t("span",{staticClass:"line"},[s._v("51")]),t("br"),t("span",{staticClass:"line"},[s._v("52")]),t("br"),t("span",{staticClass:"line"},[s._v("53")]),t("br"),t("span",{staticClass:"line"},[s._v("54")]),t("br"),t("span",{staticClass:"line"},[s._v("55")]),t("br"),t("span",{staticClass:"line"},[s._v("56")]),t("br"),t("span",{staticClass:"line"},[s._v("57")]),t("br"),t("span",{staticClass:"line"},[s._v("58")]),t("br"),t("span",{staticClass:"line"},[s._v("59")]),t("br"),t("span",{staticClass:"line"},[s._v("60")]),t("br"),t("span",{staticClass:"line"},[s._v("61")]),t("br"),t("span",{staticClass:"line"},[s._v("62")]),t("br"),t("span",{staticClass:"line"},[s._v("63")]),t("br"),t("span",{staticClass:"line"},[s._v("64")]),t("br"),t("span",{staticClass:"line"},[s._v("65")]),t("br"),t("span",{staticClass:"line"},[s._v("66")]),t("br"),t("span",{staticClass:"line"},[s._v("67")]),t("br"),t("span",{staticClass:"line"},[s._v("68")]),t("br"),t("span",{staticClass:"line"},[s._v("69")]),t("br"),t("span",{staticClass:"line"},[s._v("70")]),t("br"),t("span",{staticClass:"line"},[s._v("71")]),t("br"),t("span",{staticClass:"line"},[s._v("72")]),t("br"),t("span",{staticClass:"line"},[s._v("73")]),t("br"),t("span",{staticClass:"line"},[s._v("74")]),t("br"),t("span",{staticClass:"line"},[s._v("75")]),t("br"),t("span",{staticClass:"line"},[s._v("76")]),t("br"),t("span",{staticClass:"line"},[s._v("77")]),t("br"),t("span",{staticClass:"line"},[s._v("78")]),t("br"),t("span",{staticClass:"line"},[s._v("79")]),t("br"),t("span",{staticClass:"line"},[s._v("80")]),t("br"),t("span",{staticClass:"line"},[s._v("81")]),t("br"),t("span",{staticClass:"line"},[s._v("82")]),t("br"),t("span",{staticClass:"line"},[s._v("83")]),t("br"),t("span",{staticClass:"line"},[s._v("84")]),t("br"),t("span",{staticClass:"line"},[s._v("85")]),t("br"),t("span",{staticClass:"line"},[s._v("86")]),t("br"),t("span",{staticClass:"line"},[s._v("87")]),t("br"),t("span",{staticClass:"line"},[s._v("88")]),t("br"),t("span",{staticClass:"line"},[s._v("89")]),t("br"),t("span",{staticClass:"line"},[s._v("90")]),t("br"),t("span",{staticClass:"line"},[s._v("91")]),t("br"),t("span",{staticClass:"line"},[s._v("92")]),t("br"),t("span",{staticClass:"line"},[s._v("93")]),t("br"),t("span",{staticClass:"line"},[s._v("94")]),t("br"),t("span",{staticClass:"line"},[s._v("95")]),t("br"),t("span",{staticClass:"line"},[s._v("96")]),t("br"),t("span",{staticClass:"line"},[s._v("97")]),t("br"),t("span",{staticClass:"line"},[s._v("98")]),t("br"),t("span",{staticClass:"line"},[s._v("99")]),t("br"),t("span",{staticClass:"line"},[s._v("100")]),t("br"),t("span",{staticClass:"line"},[s._v("101")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[s._v(" _handleOnErrorStackInfo: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("stackInfo, options")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    options.mechanism = options.mechanism || {")]),t("br"),t("span",{staticClass:"line"},[s._v("      type: "),t("span",{staticClass:"string"},[s._v("'onerror'")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("      handled: "),t("span",{staticClass:"literal"},[s._v("false")])]),t("br"),t("span",{staticClass:"line"},[s._v("    };")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// mechanism 和错误统计来源有关")])]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (!"),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._ignoreOnError) {")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._handleStackInfo(stackInfo, options);")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"},[s._v("},")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("_handleStackInfo: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("stackInfo, options")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" frames = "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._prepareFrames(stackInfo, options);")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._triggerEvent("),t("span",{staticClass:"string"},[s._v("'handle'")]),s._v(", {")]),t("br"),t("span",{staticClass:"line"},[s._v("      stackInfo: stackInfo,")]),t("br"),t("span",{staticClass:"line"},[s._v("      options: options")]),t("br"),t("span",{staticClass:"line"},[s._v("    });")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._processException(")]),t("br"),t("span",{staticClass:"line"},[s._v("      stackInfo.name,")]),t("br"),t("span",{staticClass:"line"},[s._v("      stackInfo.message,")]),t("br"),t("span",{staticClass:"line"},[s._v("      stackInfo.url,")]),t("br"),t("span",{staticClass:"line"},[s._v("      stackInfo.lineno,")]),t("br"),t("span",{staticClass:"line"},[s._v("      frames,")]),t("br"),t("span",{staticClass:"line"},[s._v("      options")]),t("br"),t("span",{staticClass:"line"},[s._v("    );")]),t("br"),t("span",{staticClass:"line"},[s._v("},")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("_processException: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("type, message, fileurl, lineno, frames, options")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// 首先根据 message 信息判断是否是需要忽略的错误类型")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// 然后判断出错的文件是否在黑名单中或者白名单中")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// 接下来对错误内容进行必要的整合与转换，构造出 data 对象")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// 最后调用上报函数")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._send(data);")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("_send: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("data")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("\t")]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 对 data 进一步处理，增加必要的信息，包括后续会提到的面包屑信息")])]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 交由 _sendProcessedPayload 进行进一步处理")])]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._sendProcessedPayload(data);")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("_sendProcessedPayload: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("data, callback")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 对 data 增加一些必要的元信息")])]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 可以通过自定义 globalOptions.transport 的方式来自定义上报函数 ")])]),t("br"),t("span",{staticClass:"line"},[s._v("\t(globalOptions.transport || "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v("._makeRequest).call("),t("span",{staticClass:"keyword"},[s._v("this")]),s._v(", {")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     url: url,")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     auth: auth,")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     data: data,")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     options: globalOptions,")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     onSuccess: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("success")]),s._v("("),t("span",{staticClass:"params"}),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("\t       ")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     },")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     onError: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("failure")]),s._v("("),t("span",{staticClass:"params"},[s._v("error")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("\t       ")]),t("br"),t("span",{staticClass:"line"},[s._v("\t     }")]),t("br"),t("span",{staticClass:"line"},[s._v("\t});")]),t("br"),t("span",{staticClass:"line"},[s._v("}    ")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"comment"},[s._v("// 真正发起请求的函数")])]),t("br"),t("span",{staticClass:"line"},[s._v("_makeRequest: "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("opts")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 对于支持 fetch 的浏览器，直接使用 fetch 的方式发送 POST 请求")])]),t("br"),t("span",{staticClass:"line"},[s._v("\t"),t("span",{staticClass:"comment"},[s._v("// 如果浏览器不支持 fetch，则使用 XHR 的传统方式发送 POST 请求")])]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("``")]),t("span",{staticClass:"string"},[s._v("` ")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("实际上我们可以发现，从拿到已经初步格式化的报错信息，到最终真正执行数据上报，raven.js 的过程非常漫长，这其中我分析有如下几个原因：")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("* 每个函数只处理一件或者一些事情，保持函数的短小整洁。")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("* 部分函数可以做到复用（因为除了自动捕获错误的方式， raven.js 还提供通过 captureException，即 `")]),t("span",{staticClass:"keyword"},[s._v("try")]),s._v(" {")]),t("br"),t("span",{staticClass:"line"},[s._v("    doSomething(a["),t("span",{staticClass:"number"},[s._v("0")]),s._v("])")]),t("br"),t("span",{staticClass:"line"},[s._v("} "),t("span",{staticClass:"keyword"},[s._v("catch")]),s._v("(e) {")]),t("br"),t("span",{staticClass:"line"},[s._v("    Raven.captureException(e)")]),t("br"),t("span",{staticClass:"line"},[s._v("}"),t("span",{staticClass:"string"},[s._v("` 的方式来上报错误，两个过程中有一些函数的调用是有重叠的）。")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("但是笔者认为，raven.js 的代码设计还有很多值得优化的地方，比如：")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("* 对最终上报数据（data）的属性处理和增加分散在多个函数，并且有较多可选项目，很难梳理出一个完整的 data 格式，并且不便于维护。")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("* 部分函数的拆分必要性不足，并且会增加链路的复杂性，比如 `")]),s._v("_processException "),t("span",{staticClass:"string"},[s._v("`、`")]),s._v("_sendProcessedPayload "),t("span",{staticClass:"string"},[s._v("`、`")]),s._v("_makeRequest "),t("span",{staticClass:"string"},[s._v("`等都只在一个链路中被调用一次。")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("* 部分属性重命名会造成资源浪费，由于 TraceKit 部分最终返回的数据格式并不完全满足 raven.js 的需要，所以 raven.js 之后又在较后阶段进行了重命名等处理，实际上这些内容完全可以通过一些其他的方式避免。")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("最后，非常遗憾，sentry 目前完全不支持合并上报，就算是在同一个事件循环（甚至事件循环的同一个阶段，关于事件循环，可以参考我之前绘制的[一张图](https://www.processon.com/view/link/5b6ec8cbe4b053a09c2fb977)）的两个错误，sentry 都是分开来上报的，这里有一个简单例子：")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"})]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"string"},[s._v("`")]),t("span",{staticClass:"string"},[s._v("``")]),s._v("javascript")]),t("br"),t("span",{staticClass:"line"},[s._v("Raven.config("),t("span",{staticClass:"string"},[s._v("'http://8ec3f1a9f652463bb58191bd0b35f20c@localhost:9000/2'")]),s._v(").install()")]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"keyword"},[s._v("let")]),s._v(" s = "),t("span",{staticClass:"built_in"},[s._v("window")]),s._v(".ss;")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"keyword"},[s._v("try")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("let")]),s._v(" b = s.b")]),t("br"),t("span",{staticClass:"line"},[s._v("} "),t("span",{staticClass:"keyword"},[s._v("catch")]),s._v(" (e) {")]),t("br"),t("span",{staticClass:"line"},[s._v("    Raven.captureException(e)")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// sentry should report error now")])]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("s.nomethod();")]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"comment"},[s._v("// sentry should report error now")])]),t("br")])])])])]),s._v(" "),t("p",[s._v("以上例子中，sentry 会发送两个 POST 请求。")]),s._v(" "),t("h3",{attrs:{id:"raven-js-最终上报数据的格式"}},[t("a",{staticClass:"headerlink",attrs:{href:"#raven-js-最终上报数据的格式",title:"raven.js 最终上报数据的格式"}}),s._v("raven.js 最终上报数据的格式\n            ")]),s._v(" "),t("p",[s._v("这一部分，我们并不会详细地分析 raven.js 上报的数据的每一项内容，仅会给读者展示一个比较典型的情况。")]),s._v(" "),t("p",[s._v("我们看一下对于一个一般的 js 错误，raven.js 上报的 json 中包含哪些内容，下面是一个已经删掉一些冗余内容的典型上报信息：")]),s._v(" "),t("figure",{staticClass:"highlight json"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br"),t("span",{staticClass:"line"},[s._v("11")]),t("br"),t("span",{staticClass:"line"},[s._v("12")]),t("br"),t("span",{staticClass:"line"},[s._v("13")]),t("br"),t("span",{staticClass:"line"},[s._v("14")]),t("br"),t("span",{staticClass:"line"},[s._v("15")]),t("br"),t("span",{staticClass:"line"},[s._v("16")]),t("br"),t("span",{staticClass:"line"},[s._v("17")]),t("br"),t("span",{staticClass:"line"},[s._v("18")]),t("br"),t("span",{staticClass:"line"},[s._v("19")]),t("br"),t("span",{staticClass:"line"},[s._v("20")]),t("br"),t("span",{staticClass:"line"},[s._v("21")]),t("br"),t("span",{staticClass:"line"},[s._v("22")]),t("br"),t("span",{staticClass:"line"},[s._v("23")]),t("br"),t("span",{staticClass:"line"},[s._v("24")]),t("br"),t("span",{staticClass:"line"},[s._v("25")]),t("br"),t("span",{staticClass:"line"},[s._v("26")]),t("br"),t("span",{staticClass:"line"},[s._v("27")]),t("br"),t("span",{staticClass:"line"},[s._v("28")]),t("br"),t("span",{staticClass:"line"},[s._v("29")]),t("br"),t("span",{staticClass:"line"},[s._v("30")]),t("br"),t("span",{staticClass:"line"},[s._v("31")]),t("br"),t("span",{staticClass:"line"},[s._v("32")]),t("br"),t("span",{staticClass:"line"},[s._v("33")]),t("br"),t("span",{staticClass:"line"},[s._v("34")]),t("br"),t("span",{staticClass:"line"},[s._v("35")]),t("br"),t("span",{staticClass:"line"},[s._v("36")]),t("br"),t("span",{staticClass:"line"},[s._v("37")]),t("br"),t("span",{staticClass:"line"},[s._v("38")]),t("br"),t("span",{staticClass:"line"},[s._v("39")]),t("br"),t("span",{staticClass:"line"},[s._v("40")]),t("br"),t("span",{staticClass:"line"},[s._v("41")]),t("br"),t("span",{staticClass:"line"},[s._v("42")]),t("br"),t("span",{staticClass:"line"},[s._v("43")]),t("br"),t("span",{staticClass:"line"},[s._v("44")]),t("br"),t("span",{staticClass:"line"},[s._v("45")]),t("br"),t("span",{staticClass:"line"},[s._v("46")]),t("br"),t("span",{staticClass:"line"},[s._v("47")]),t("br"),t("span",{staticClass:"line"},[s._v("48")]),t("br"),t("span",{staticClass:"line"},[s._v("49")]),t("br"),t("span",{staticClass:"line"},[s._v("50")]),t("br"),t("span",{staticClass:"line"},[s._v("51")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"project"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"2"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"logger"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"javascript"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"platform"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"javascript"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"request"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"headers"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"attr"},[s._v('"User-Agent"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1"')])]),t("br"),t("span",{staticClass:"line"},[s._v("    },")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"url"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu"')])]),t("br"),t("span",{staticClass:"line"},[s._v("  },")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"exception"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"values"')]),s._v(": [")]),t("br"),t("span",{staticClass:"line"},[s._v("      {")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"type"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"TypeError"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"value"')]),s._v(": "),t("span",{staticClass:"string"},[s._v("\"Cannot read property 'b' of undefined\"")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"stacktrace"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("          "),t("span",{staticClass:"attr"},[s._v('"frames"')]),s._v(": [")]),t("br"),t("span",{staticClass:"line"},[s._v("            {")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"attr"},[s._v('"filename"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"attr"},[s._v('"lineno"')]),s._v(": "),t("span",{staticClass:"number"},[s._v("19")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"attr"},[s._v('"colno"')]),s._v(": "),t("span",{staticClass:"number"},[s._v("19")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"attr"},[s._v('"function"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"?"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"attr"},[s._v('"in_app"')]),s._v(": "),t("span",{staticClass:"literal"},[s._v("true")])]),t("br"),t("span",{staticClass:"line"},[s._v("            }")]),t("br"),t("span",{staticClass:"line"},[s._v("          ]")]),t("br"),t("span",{staticClass:"line"},[s._v("        }")]),t("br"),t("span",{staticClass:"line"},[s._v("      }")]),t("br"),t("span",{staticClass:"line"},[s._v("    ],")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"mechanism"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"attr"},[s._v('"type"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"generic"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"attr"},[s._v('"handled"')]),s._v(": "),t("span",{staticClass:"literal"},[s._v("true")])]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"},[s._v("  },")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"transaction"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"extra"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"session:duration"')]),s._v(": "),t("span",{staticClass:"number"},[s._v("6")])]),t("br"),t("span",{staticClass:"line"},[s._v("  },")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"breadcrumbs"')]),s._v(": {")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"attr"},[s._v('"values"')]),s._v(": [")]),t("br"),t("span",{staticClass:"line"},[s._v("      {")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"timestamp"')]),s._v(": "),t("span",{staticClass:"number"},[s._v("1534257309.996")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"message"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"_prepareFrames stackInfo: [object Object]"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"level"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"log"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("        "),t("span",{staticClass:"attr"},[s._v('"category"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"console"')])]),t("br"),t("span",{staticClass:"line"},[s._v("      },")]),t("br"),t("span",{staticClass:"line"},[s._v("      // ...")]),t("br"),t("span",{staticClass:"line"},[s._v("   ]")]),t("br"),t("span",{staticClass:"line"},[s._v("  },")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"event_id"')]),s._v(": "),t("span",{staticClass:"string"},[s._v('"ea0334adaf9d43b78e72da2b10e084a9"')]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"attr"},[s._v('"trimHeadFrames"')]),s._v(": "),t("span",{staticClass:"number"},[s._v("0")])]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br")])])])])]),s._v(" "),t("p",[s._v("其中支持的信息类型重点分为以下几种：")]),s._v(" "),t("ul",[t("li",[s._v("sentry 基本配置信息，包括库本身的配置和使用者的配置信息，以及用户的一些自定义信息")]),s._v(" "),t("li",[s._v("错误信息，主要包括错误调用栈信息")]),s._v(" "),t("li",[s._v("request 信息，主要包括浏览器的 User-Agent、当前请求地址等")]),s._v(" "),t("li",[s._v("面包屑信息，关于面包屑具体指的是什么，我们会在下一环节进行介绍")])]),s._v(" "),t("h3",{attrs:{id:"raven-js-面包屑收集"}},[t("a",{staticClass:"headerlink",attrs:{href:"#raven-js-面包屑收集",title:"raven.js 面包屑收集"}}),s._v("raven.js 面包屑收集\n            ")]),s._v(" "),t("p",[s._v("面包屑信息，也就是错误在发生之前，一些用户、浏览器的行为信息，raven.js 实现了一个简单的队列（有一个最大条目长度，默认为 100），这个队列在时刻记录着这些信息，一旦错误发生并且需要上报，raven.js 就把这个队列的信息内容，作为面包屑 breadcrumbs，发回客户端。")]),s._v(" "),t("p",[s._v("面包屑信息主要包括这几类：")]),s._v(" "),t("ul",[t("li",[s._v("用户对某个元素的点击或者用户对某个可输入元素的输入")]),s._v(" "),t("li",[s._v("发送的 http 请求")]),s._v(" "),t("li",[s._v("console 打印的信息（支持配置 ‘debug’, ‘info’, ‘warn’, ‘error’, ‘log’ 等不同级别）")]),s._v(" "),t("li",[s._v("window.location 变化信息")])]),s._v(" "),t("p",[s._v("接下来，我们对这几类面包屑信息 sentry 的记录实现进行简单的分析。")]),s._v(" "),t("p",[s._v("实际上，sentry 对这些信息记录的方式比较一致，都是通过对原声的函数进行包装，并且在包装好的函数中增加自己的钩子函数，来实现触发时候的事件记录，实际上，sentry 总共包装的函数有：")]),s._v(" "),t("ul",[t("li",[s._v("window.setTimeout")]),s._v(" "),t("li",[s._v("window.setInterval")]),s._v(" "),t("li",[s._v("window.requestAnimationFrame")]),s._v(" "),t("li",[s._v("EventTarget.addEventListener")]),s._v(" "),t("li",[s._v("EventTarget.removeEventListener")]),s._v(" "),t("li",[s._v("XMLHTTPRequest.open")]),s._v(" "),t("li",[s._v("XMLHTTPRequest.send")]),s._v(" "),t("li",[s._v("window.fetch")]),s._v(" "),t("li",[s._v("History.pushState")]),s._v(" "),t("li",[s._v("History.replaceState")])]),s._v(" "),t("blockquote",[t("p",[s._v("备注：这里包装的所有函数，其中有一部分只是使 raven.js 具有捕获回调函数中错误的能力（对回调函数进行包装）")])]),s._v(" "),t("p",[s._v("接下来我们看一段典型的代码，来分析 raven.js 是如何记录用户的点击和输入信息的（通过对 EventTarget.addEventListener 进行封装）：")]),s._v(" "),t("figure",{staticClass:"highlight javascript"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br"),t("span",{staticClass:"line"},[s._v("11")]),t("br"),t("span",{staticClass:"line"},[s._v("12")]),t("br"),t("span",{staticClass:"line"},[s._v("13")]),t("br"),t("span",{staticClass:"line"},[s._v("14")]),t("br"),t("span",{staticClass:"line"},[s._v("15")]),t("br"),t("span",{staticClass:"line"},[s._v("16")]),t("br"),t("span",{staticClass:"line"},[s._v("17")]),t("br"),t("span",{staticClass:"line"},[s._v("18")]),t("br"),t("span",{staticClass:"line"},[s._v("19")]),t("br"),t("span",{staticClass:"line"},[s._v("20")]),t("br"),t("span",{staticClass:"line"},[s._v("21")]),t("br"),t("span",{staticClass:"line"},[s._v("22")]),t("br"),t("span",{staticClass:"line"},[s._v("23")]),t("br"),t("span",{staticClass:"line"},[s._v("24")]),t("br"),t("span",{staticClass:"line"},[s._v("25")]),t("br"),t("span",{staticClass:"line"},[s._v("26")]),t("br"),t("span",{staticClass:"line"},[s._v("27")]),t("br"),t("span",{staticClass:"line"},[s._v("28")]),t("br"),t("span",{staticClass:"line"},[s._v("29")]),t("br"),t("span",{staticClass:"line"},[s._v("30")]),t("br"),t("span",{staticClass:"line"},[s._v("31")]),t("br"),t("span",{staticClass:"line"},[s._v("32")]),t("br"),t("span",{staticClass:"line"},[s._v("33")]),t("br"),t("span",{staticClass:"line"},[s._v("34")]),t("br"),t("span",{staticClass:"line"},[s._v("35")]),t("br"),t("span",{staticClass:"line"},[s._v("36")]),t("br"),t("span",{staticClass:"line"},[s._v("37")]),t("br"),t("span",{staticClass:"line"},[s._v("38")]),t("br"),t("span",{staticClass:"line"},[s._v("39")]),t("br"),t("span",{staticClass:"line"},[s._v("40")]),t("br"),t("span",{staticClass:"line"},[s._v("41")]),t("br"),t("span",{staticClass:"line"},[s._v("42")]),t("br"),t("span",{staticClass:"line"},[s._v("43")]),t("br"),t("span",{staticClass:"line"},[s._v("44")]),t("br"),t("span",{staticClass:"line"},[s._v("45")]),t("br"),t("span",{staticClass:"line"},[s._v("46")]),t("br"),t("span",{staticClass:"line"},[s._v("47")]),t("br"),t("span",{staticClass:"line"},[s._v("48")]),t("br"),t("span",{staticClass:"line"},[s._v("49")]),t("br"),t("span",{staticClass:"line"},[s._v("50")]),t("br"),t("span",{staticClass:"line"},[s._v("51")]),t("br"),t("span",{staticClass:"line"},[s._v("52")]),t("br"),t("span",{staticClass:"line"},[s._v("53")]),t("br"),t("span",{staticClass:"line"},[s._v("54")]),t("br"),t("span",{staticClass:"line"},[s._v("55")]),t("br"),t("span",{staticClass:"line"},[s._v("56")]),t("br"),t("span",{staticClass:"line"},[s._v("57")]),t("br"),t("span",{staticClass:"line"},[s._v("58")]),t("br"),t("span",{staticClass:"line"},[s._v("59")]),t("br"),t("span",{staticClass:"line"},[s._v("60")]),t("br"),t("span",{staticClass:"line"},[s._v("61")]),t("br"),t("span",{staticClass:"line"},[s._v("62")]),t("br"),t("span",{staticClass:"line"},[s._v("63")]),t("br"),t("span",{staticClass:"line"},[s._v("64")]),t("br"),t("span",{staticClass:"line"},[s._v("65")]),t("br"),t("span",{staticClass:"line"},[s._v("66")]),t("br"),t("span",{staticClass:"line"},[s._v("67")]),t("br"),t("span",{staticClass:"line"},[s._v("68")]),t("br"),t("span",{staticClass:"line"},[s._v("69")]),t("br"),t("span",{staticClass:"line"},[s._v("70")]),t("br"),t("span",{staticClass:"line"},[s._v("71")]),t("br"),t("span",{staticClass:"line"},[s._v("72")]),t("br"),t("span",{staticClass:"line"},[s._v("73")]),t("br"),t("span",{staticClass:"line"},[s._v("74")]),t("br"),t("span",{staticClass:"line"},[s._v("75")]),t("br"),t("span",{staticClass:"line"},[s._v("76")]),t("br"),t("span",{staticClass:"line"},[s._v("77")]),t("br"),t("span",{staticClass:"line"},[s._v("78")]),t("br"),t("span",{staticClass:"line"},[s._v("79")]),t("br"),t("span",{staticClass:"line"},[s._v("80")]),t("br"),t("span",{staticClass:"line"},[s._v("81")]),t("br"),t("span",{staticClass:"line"},[s._v("82")]),t("br"),t("span",{staticClass:"line"},[s._v("83")]),t("br"),t("span",{staticClass:"line"},[s._v("84")]),t("br"),t("span",{staticClass:"line"},[s._v("85")]),t("br"),t("span",{staticClass:"line"},[s._v("86")]),t("br"),t("span",{staticClass:"line"},[s._v("87")]),t("br"),t("span",{staticClass:"line"},[s._v("88")]),t("br"),t("span",{staticClass:"line"},[s._v("89")]),t("br"),t("span",{staticClass:"line"},[s._v("90")]),t("br"),t("span",{staticClass:"line"},[s._v("91")]),t("br"),t("span",{staticClass:"line"},[s._v("92")]),t("br"),t("span",{staticClass:"line"},[s._v("93")]),t("br"),t("span",{staticClass:"line"},[s._v("94")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("wrapEventTarget")]),s._v("("),t("span",{staticClass:"params"},[s._v("global")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" proto = _window[global] && _window[global].prototype;")]),t("br"),t("span",{staticClass:"line"},[s._v("      "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (proto && proto.hasOwnProperty && proto.hasOwnProperty("),t("span",{staticClass:"string"},[s._v("'addEventListener'")]),s._v(")) {")]),t("br"),t("span",{staticClass:"line"},[s._v("        fill(")]),t("br"),t("span",{staticClass:"line"},[s._v("          proto,")]),t("br"),t("span",{staticClass:"line"},[s._v("          "),t("span",{staticClass:"string"},[s._v("'addEventListener'")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("          "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("orig")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("            "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("evtName, fn, capture, secure")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("try")]),s._v(" {")]),t("br"),t("span",{staticClass:"line"},[s._v("                "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (fn && fn.handleEvent) { "),t("span",{staticClass:"comment"},[s._v("//兼容通过 handleEvent 的方式进行绑定事件")])]),t("br"),t("span",{staticClass:"line"},[s._v("                  fn.handleEvent = self.wrap(")]),t("br"),t("span",{staticClass:"line"},[s._v("                    {")]),t("br"),t("span",{staticClass:"line"},[s._v("                      mechanism: {")]),t("br"),t("span",{staticClass:"line"},[s._v("                        type: "),t("span",{staticClass:"string"},[s._v("'instrument'")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("                        data: {")]),t("br"),t("span",{staticClass:"line"},[s._v("                          target: global,")]),t("br"),t("span",{staticClass:"line"},[s._v("                          "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(": '"),t("span",{staticClass:"title"},[s._v("handleEvent")]),s._v("',")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                          "),t("span",{staticClass:"title"},[s._v("handler")]),s._v(": ("),t("span",{staticClass:"params"},[s._v("fn && fn.name")]),s._v(") || '<"),t("span",{staticClass:"title"},[s._v("anonymous")]),s._v(">'")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                        }")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                      }")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                    },")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                    "),t("span",{staticClass:"title"},[s._v("fn")]),s._v("."),t("span",{staticClass:"title"},[s._v("handleEvent")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                  );")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                }")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("              } "),t("span",{staticClass:"title"},[s._v("catch")]),s._v(" ("),t("span",{staticClass:"params"},[s._v("err")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("              }")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" before, clickHandler, keypressHandler;")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (")]),t("br"),t("span",{staticClass:"line"},[s._v("                autoBreadcrumbs &&")]),t("br"),t("span",{staticClass:"line"},[s._v("                autoBreadcrumbs.dom &&")]),t("br"),t("span",{staticClass:"line"},[s._v("                (global === "),t("span",{staticClass:"string"},[s._v("'EventTarget'")]),s._v(" || global === "),t("span",{staticClass:"string"},[s._v("'Node'")]),s._v(")")]),t("br"),t("span",{staticClass:"line"},[s._v("              ) {")]),t("br"),t("span",{staticClass:"line"},[s._v("                "),t("span",{staticClass:"comment"},[s._v("// "),t("span",{staticClass:"doctag"},[s._v("NOTE:")]),s._v(" generating multiple handlers per addEventListener invocation, should")])]),t("br"),t("span",{staticClass:"line"},[s._v("                "),t("span",{staticClass:"comment"},[s._v("//       revisit and verify we can just use one (almost certainly)")])]),t("br"),t("span",{staticClass:"line"},[s._v("                clickHandler = self._breadcrumbEventHandler("),t("span",{staticClass:"string"},[s._v("'click'")]),s._v(");")]),t("br"),t("span",{staticClass:"line"},[s._v("                keypressHandler = self._keypressEventHandler();")]),t("br"),t("span",{staticClass:"line"},[s._v("                before = "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("evt")]),s._v(") ")]),s._v("{ "),t("span",{staticClass:"comment"},[s._v("// 钩子函数，用于在回调函数调用的时候记录信息")])]),t("br"),t("span",{staticClass:"line"},[s._v("                  "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (!evt) "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(";")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("                  "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" eventType;")]),t("br"),t("span",{staticClass:"line"},[s._v("                  "),t("span",{staticClass:"keyword"},[s._v("try")]),s._v(" {")]),t("br"),t("span",{staticClass:"line"},[s._v("                    eventType = evt.type;")]),t("br"),t("span",{staticClass:"line"},[s._v("                  } "),t("span",{staticClass:"keyword"},[s._v("catch")]),s._v(" (e) {")]),t("br"),t("span",{staticClass:"line"},[s._v("                    "),t("span",{staticClass:"comment"},[s._v("// just accessing event properties can throw an exception in some rare circumstances")])]),t("br"),t("span",{staticClass:"line"},[s._v("                    "),t("span",{staticClass:"comment"},[s._v("// see: https://github.com/getsentry/raven-js/issues/838")])]),t("br"),t("span",{staticClass:"line"},[s._v("                    "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(";")]),t("br"),t("span",{staticClass:"line"},[s._v("                  }")]),t("br"),t("span",{staticClass:"line"},[s._v("                  "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (eventType === "),t("span",{staticClass:"string"},[s._v("'click'")]),s._v(") "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" clickHandler(evt);")]),t("br"),t("span",{staticClass:"line"},[s._v("                  "),t("span",{staticClass:"keyword"},[s._v("else")]),s._v(" "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (eventType === "),t("span",{staticClass:"string"},[s._v("'keypress'")]),s._v(") "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" keypressHandler(evt);")]),t("br"),t("span",{staticClass:"line"},[s._v("                };")]),t("br"),t("span",{staticClass:"line"},[s._v("              }")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" orig.call(")]),t("br"),t("span",{staticClass:"line"},[s._v("                "),t("span",{staticClass:"keyword"},[s._v("this")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("                evtName,")]),t("br"),t("span",{staticClass:"line"},[s._v("                self.wrap(")]),t("br"),t("span",{staticClass:"line"},[s._v("                  {")]),t("br"),t("span",{staticClass:"line"},[s._v("                    mechanism: {")]),t("br"),t("span",{staticClass:"line"},[s._v("                      type: "),t("span",{staticClass:"string"},[s._v("'instrument'")]),s._v(",")]),t("br"),t("span",{staticClass:"line"},[s._v("                      data: {")]),t("br"),t("span",{staticClass:"line"},[s._v("                        target: global,")]),t("br"),t("span",{staticClass:"line"},[s._v("                        "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(": '"),t("span",{staticClass:"title"},[s._v("addEventListener")]),s._v("',")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                        "),t("span",{staticClass:"title"},[s._v("handler")]),s._v(": ("),t("span",{staticClass:"params"},[s._v("fn && fn.name")]),s._v(") || '<"),t("span",{staticClass:"title"},[s._v("anonymous")]),s._v(">'")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                      }")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                    }")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                  },")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                  "),t("span",{staticClass:"title"},[s._v("fn")]),s._v(",")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                  "),t("span",{staticClass:"title"},[s._v("before")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                ),")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                "),t("span",{staticClass:"title"},[s._v("capture")]),s._v(",")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("                "),t("span",{staticClass:"title"},[s._v("secure")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("              );")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("            };")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("          },")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("          "),t("span",{staticClass:"title"},[s._v("wrappedBuiltIns")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("        );")])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[s._v("        "),t("span",{staticClass:"title"},[s._v("fill")]),s._v("("),t("span",{staticClass:"params"})])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"params"},[s._v("          proto,")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"params"},[s._v("          "),t("span",{staticClass:"string"},[s._v("'removeEventListener'")]),s._v(",")])])]),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"params"},[s._v("          function(orig")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("            "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"params"},[s._v("evt, fn, capture, secure")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("try")]),s._v(" {")]),t("br"),t("span",{staticClass:"line"},[s._v("                fn = fn && (fn.__raven_wrapper__ ? fn.__raven_wrapper__ : fn);")]),t("br"),t("span",{staticClass:"line"},[s._v("              } "),t("span",{staticClass:"keyword"},[s._v("catch")]),s._v(" (e) {")]),t("br"),t("span",{staticClass:"line"},[s._v("                "),t("span",{staticClass:"comment"},[s._v("// ignore, accessing __raven_wrapper__ will throw in some Selenium environments")])]),t("br"),t("span",{staticClass:"line"},[s._v("              }")]),t("br"),t("span",{staticClass:"line"},[s._v("              "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" orig.call("),t("span",{staticClass:"keyword"},[s._v("this")]),s._v(", evt, fn, capture, secure);")]),t("br"),t("span",{staticClass:"line"},[s._v("            };")]),t("br"),t("span",{staticClass:"line"},[s._v("          },")]),t("br"),t("span",{staticClass:"line"},[s._v("          wrappedBuiltIns")]),t("br"),t("span",{staticClass:"line"},[s._v("        );")]),t("br"),t("span",{staticClass:"line"},[s._v("      }")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br")])])])])]),s._v(" "),t("p",[s._v("以上代码兼容了通过 handleEvent 的方式进行绑定事件（如果没有听说过这种方式，可以在\n                "),t("a",{attrs:{href:"http://www.ayqy.net/blog/handleevent%E4%B8%8Eaddeventlistener/",target:"_blank",rel:"noopener"}},[s._v("这里")]),s._v("补充一些相关的知识）。")]),s._v(" "),t("p",[s._v("默认情况下，raven.js 只记录通过\n                "),t("code",[s._v("EventTarget.addEventListener")]),s._v(" 绑定的点击和输入信息，实际上这是比较科学的，并且这些信息较为有效。另外，raven.js 也提供了记录所有点击和输入信息的可选项，其实现方式更为简单，直接在 document 上添加相关的监听即可。")]),s._v(" "),t("h3",{attrs:{id:"raven-js-如何和框架配合使用"}},[t("a",{staticClass:"headerlink",attrs:{href:"#raven-js-如何和框架配合使用",title:"raven.js 如何和框架配合使用"}}),s._v("raven.js 如何和框架配合使用\n            ")]),s._v(" "),t("p",[s._v("raven.js 和框架配合使用的方式非常简单，但是我们要知道，很多框架内置了错误边界处理，或者对错误进行转义。以至于我们通过 window.onerror 的方式得不到完整的错误信息。同时，有些框架提供了错误处理的接口（比如 vue），利用错误处理的接口，我们能够获取到和错误有关的更多更重要的信息。\n            ")]),s._v(" "),t("p",[s._v("raven.js 利用各个框架的官方接口，提供了 vue、require.js、angular、ember、react-native 等各个框架的官方插件。")]),s._v(" "),t("p",[s._v("插件内容本身非常简单，我们可以看一下 vue 插件的代码：")]),s._v(" "),t("figure",{staticClass:"highlight javascript"},[t("table",[t("tr",[t("td",{staticClass:"gutter"},[t("pre",[t("span",{staticClass:"line"},[s._v("1")]),t("br"),t("span",{staticClass:"line"},[s._v("2")]),t("br"),t("span",{staticClass:"line"},[s._v("3")]),t("br"),t("span",{staticClass:"line"},[s._v("4")]),t("br"),t("span",{staticClass:"line"},[s._v("5")]),t("br"),t("span",{staticClass:"line"},[s._v("6")]),t("br"),t("span",{staticClass:"line"},[s._v("7")]),t("br"),t("span",{staticClass:"line"},[s._v("8")]),t("br"),t("span",{staticClass:"line"},[s._v("9")]),t("br"),t("span",{staticClass:"line"},[s._v("10")]),t("br"),t("span",{staticClass:"line"},[s._v("11")]),t("br"),t("span",{staticClass:"line"},[s._v("12")]),t("br"),t("span",{staticClass:"line"},[s._v("13")]),t("br"),t("span",{staticClass:"line"},[s._v("14")]),t("br"),t("span",{staticClass:"line"},[s._v("15")]),t("br"),t("span",{staticClass:"line"},[s._v("16")]),t("br"),t("span",{staticClass:"line"},[s._v("17")]),t("br"),t("span",{staticClass:"line"},[s._v("18")]),t("br"),t("span",{staticClass:"line"},[s._v("19")]),t("br"),t("span",{staticClass:"line"},[s._v("20")]),t("br"),t("span",{staticClass:"line"},[s._v("21")]),t("br"),t("span",{staticClass:"line"},[s._v("22")]),t("br"),t("span",{staticClass:"line"},[s._v("23")]),t("br"),t("span",{staticClass:"line"},[s._v("24")]),t("br"),t("span",{staticClass:"line"},[s._v("25")]),t("br"),t("span",{staticClass:"line"},[s._v("26")]),t("br"),t("span",{staticClass:"line"},[s._v("27")]),t("br"),t("span",{staticClass:"line"},[s._v("28")]),t("br"),t("span",{staticClass:"line"},[s._v("29")]),t("br"),t("span",{staticClass:"line"},[s._v("30")]),t("br"),t("span",{staticClass:"line"},[s._v("31")]),t("br"),t("span",{staticClass:"line"},[s._v("32")]),t("br"),t("span",{staticClass:"line"},[s._v("33")]),t("br"),t("span",{staticClass:"line"},[s._v("34")]),t("br"),t("span",{staticClass:"line"},[s._v("35")]),t("br"),t("span",{staticClass:"line"},[s._v("36")]),t("br"),t("span",{staticClass:"line"},[s._v("37")]),t("br"),t("span",{staticClass:"line"},[s._v("38")]),t("br"),t("span",{staticClass:"line"},[s._v("39")]),t("br"),t("span",{staticClass:"line"},[s._v("40")]),t("br"),t("span",{staticClass:"line"},[s._v("41")]),t("br"),t("span",{staticClass:"line"},[s._v("42")]),t("br")])]),s._v(" "),t("td",{staticClass:"code"},[t("pre",[t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("formatComponentName")]),s._v("("),t("span",{staticClass:"params"},[s._v("vm")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (vm.$root === vm) {")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"string"},[s._v("'root instance'")]),s._v(";")]),t("br"),t("span",{staticClass:"line"},[s._v("  }")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" name = vm._isVue ? vm.$options.name || vm.$options._componentTag : vm.name;")]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(" (")]),t("br"),t("span",{staticClass:"line"},[s._v("    (name ? "),t("span",{staticClass:"string"},[s._v("'component <'")]),s._v(" + name + "),t("span",{staticClass:"string"},[s._v("'>'")]),s._v(" : "),t("span",{staticClass:"string"},[s._v("'anonymous component'")]),s._v(") +")]),t("br"),t("span",{staticClass:"line"},[s._v("    (vm._isVue && vm.$options.__file ? "),t("span",{staticClass:"string"},[s._v("' at '")]),s._v(" + vm.$options.__file : "),t("span",{staticClass:"string"},[s._v("''")]),s._v(")")]),t("br"),t("span",{staticClass:"line"},[s._v("  );")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("vuePlugin")]),s._v("("),t("span",{staticClass:"params"},[s._v("Raven, Vue")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("  Vue = Vue || "),t("span",{staticClass:"built_in"},[s._v("window")]),s._v(".Vue;")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"comment"},[s._v("// quit if Vue isn't on the page")])]),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" (!Vue || !Vue.config) "),t("span",{staticClass:"keyword"},[s._v("return")]),s._v(";")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("  "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" _oldOnError = Vue.config.errorHandler;")]),t("br"),t("span",{staticClass:"line"},[s._v("  Vue.config.errorHandler = "),t("span",{staticClass:"function"},[t("span",{staticClass:"keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"title"},[s._v("VueErrorHandler")]),s._v("("),t("span",{staticClass:"params"},[s._v("error, vm, info")]),s._v(") ")]),s._v("{")]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("var")]),s._v(" metaData = {};")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"comment"},[s._v("// vm and lifecycleHook are not always available")])]),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"built_in"},[s._v("Object")]),s._v(".prototype.toString.call(vm) === "),t("span",{staticClass:"string"},[s._v("'[object Object]'")]),s._v(") {")]),t("br"),t("span",{staticClass:"line"},[s._v("      metaData.componentName = formatComponentName(vm);")]),t("br"),t("span",{staticClass:"line"},[s._v("      metaData.propsData = vm.$options.propsData;")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"keyword"},[s._v("typeof")]),s._v(" info !== "),t("span",{staticClass:"string"},[s._v("'undefined'")]),s._v(") {")]),t("br"),t("span",{staticClass:"line"},[s._v("      metaData.lifecycleHook = info;")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    Raven.captureException(error, {")]),t("br"),t("span",{staticClass:"line"},[s._v("      extra: metaData")]),t("br"),t("span",{staticClass:"line"},[s._v("    });")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[s._v("    "),t("span",{staticClass:"keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"keyword"},[s._v("typeof")]),s._v(" _oldOnError === "),t("span",{staticClass:"string"},[s._v("'function'")]),s._v(") {")]),t("br"),t("span",{staticClass:"line"},[s._v("      _oldOnError.call("),t("span",{staticClass:"keyword"},[s._v("this")]),s._v(", error, vm, info);")]),t("br"),t("span",{staticClass:"line"},[s._v("    }")]),t("br"),t("span",{staticClass:"line"},[s._v("  };")]),t("br"),t("span",{staticClass:"line"},[s._v("}")]),t("br"),t("span",{staticClass:"line"}),t("br"),t("span",{staticClass:"line"},[t("span",{staticClass:"built_in"},[s._v("module")]),s._v(".exports = vuePlugin;")]),t("br")])])])])]),s._v(" "),t("p",[s._v("应该不用进行过多解释。")]),s._v(" "),t("p",[s._v("你也许想知道为什么没有提供 react 插件，事实上，react 16 以后才引入了\n                "),t("a",{attrs:{href:"https://reactjs.org/blog/2017/07/26/error-handling-in-react-16.html",target:"_blank",rel:"noopener"}},[s._v("Error Boundaries")]),s._v("，这种方式由于灵活性太强，并不太适合使用插件，另外，就算不使用插件，也非常方便地使用 raven.js 进行错误上报，可以参考\n                "),t("a",{attrs:{href:"https://docs.sentry.io/clients/javascript/integrations/react/",target:"_blank",rel:"noopener"}},[s._v("这里")])]),s._v(" "),t("blockquote",[t("p",[s._v("但笔者认为，目前 react 的引入方式会对源代码进行侵入，并且比较难通过构建的方式进行 sentry 的配置，也许我们可以寻找更好的方式。")])]),s._v(" "),t("p",[s._v("完。")]),s._v(" "),t("div",{staticClass:"donate-container"},[t("div",{staticClass:"donate-button"},[t("button",{attrs:{id:"donate-button"}},[s._v("赞赏")])]),s._v(" "),t("div",{staticClass:"donate-img-container hide",attrs:{id:"donate-img-container"}},[t("img",{attrs:{id:"donate-img",src:"","data-src":"/img/donate.jpg"}}),s._v(" "),t("p",[s._v(" 感谢鼓励 ")])])]),s._v(" "),t("div",{attrs:{id:"comment-container"}})])])])}]};var j=t("VU/8")({name:"detail",data:function(){return{msg:"Welcome to Your Vue.js App"}}},y,!1,function(s){t("II6t")},null,null).exports,x={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"post-content "},[t("blockquote",[t("p",[s._v("大多数时候，都在思考自己该走向何方")])]),s._v(" "),t("p",[s._v("Mail: "),t("a",{attrs:{href:"mailto:onlythen@yeah.net",target:"_blank",rel:"noopener"}},[s._v("onlythen@yeah.net")])]),s._v(" "),t("p",[s._v("9月21日上午，阳光明媚，鲜花斗艳。帕洛阿尔托苹果店里欢声笑语，人头攒动。苹果公司首席执行官蒂姆·库克先生在店长欧阳猛南陪同下，不远千米，深入到一线店面，为那里的员工带去节曰的问候和良好的祝愿。"),t("br"),t("br"),s._v("“果粉们，你们辛苦了，我代表某果公司，祝你们身体健康，生活幸福，工作成功！”库克亲切慰问广大员工和顾客，并就iOS7、iPhone\n            5S和iPhone 5C的销售状况进行调研。 "),t("br"),t("br"),s._v("“您现在每月工资有多少？肾5S拿到了吗？”在店里，库克关切地向果粉们问起这一问题。当听说果粉们排到了5S，库克满意地连连点头。接着他指出，近年来苹果事业发展取得巨大成就，特别是iPhone影响剧增，老百姓对iOS满意度逐步提高，在这个转变过程中，果粉的辛勤工作功不可没。"),t("br"),t("br"),s._v("库克看到一个中国小朋友在排队买iPhone\n            5S，亲切的问：“5288元一台能承受不？”小朋友回答到：“能！”当得知这位小朋友卖了一个肾来买iPhone 5S时，库克叮嘱道：“在支持苹果的同时，也要爱护身体。”"),t("br"),t("br"),s._v("库克与购买苹果手机的果粉们兴致勃勃地参观了苹果专卖店，和员工们拉了拉家常，并饶有兴趣地玩了四盘切西瓜游戏，与普通员工同乐。"),t("br"),t("br"),s._v("在交谈中，库克多次关心地强调：“有了iPhone\n            5C，就不卖iPhone 5了。”并对顾客说：“好好休息，身体是革命的本钱嘛！”会谈始终在亲切友好的气氛中进行。"),t("br"),t("br"),s._v("顾客们就库克的讲话达成了广泛的共识，并承认世界上只有iOS最流畅，要紧紧的团结在以库克先生为首席执行官的苹果公司集体周围，一心一意抓学习，聚精会神谋发展。"),t("br"),t("br"),s._v("帕洛阿尔托苹果专卖店当日原则通过《蒂姆·库克首席执行官在加州新苹果店的讲话纪要》，并下发各分店认真学习、研讨。")]),s._v(" "),t("p",{staticStyle:{"text-align":"right"}},[t("br"),s._v(" —— "),t("a",{attrs:{href:"http://www.zhihu.com/question/19687065",target:"_blank",rel:"noopener"}},[s._v("李书航\n                － 什么是「共产中文腔调」？ ")]),t("br")]),s._v(" "),t("div",{staticClass:"donate-container"},[t("div",{staticClass:"donate-button"},[t("button",{attrs:{id:"donate-button"}},[s._v("赞赏")])]),s._v(" "),t("div",{staticClass:"donate-img-container hide",attrs:{id:"donate-img-container"}},[t("img",{attrs:{id:"donate-img",src:"","data-src":"/img/donate.jpg"}}),s._v(" "),t("p",[s._v(" 感谢鼓励 ")])])]),s._v(" "),t("div",{attrs:{id:"comment-container"}})])])}]};var E=t("VU/8")({name:"about",data:function(){return{msg:"Welcome to Your Vue.js App"}}},x,!1,function(s){t("8hSR")},null,null).exports,S={name:"index",components:{vueLoading:o.a},data:function(){return{msg:"Welcome to Your Vue.js App",postLists:{}}},created:function(){this.setNewsApi()},methods:{setNewsApi:function(){var s=this;b.a.get("/post/lists","type=top&key=123456").then(function(a){s.postLists=a.post_preview_lists})}}},P={render:function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"index-middle"},[t("div",{staticClass:"post-preview-container",staticStyle:{"min-height":"576px"}},s._l(s.postLists,function(a){return t("div",{staticClass:"post-preview"},[t("div",{staticClass:"post-time"},[s._v(s._s(a.post_time))]),s._v(" "),t("div",{staticClass:"post-info"},[t("router-link",{attrs:{to:"/detail/"+a.post_info}},[t("h3",[s._v("\n            "+s._s(a.post_info)+"\n          ")])]),s._v(" "),t("p",[t("span",[s._v("/")]),s._v(" "),s._l(a.tags,function(a){return t("span",[t("a",{staticClass:"tag",attrs:{href:"/tags/#javascript",title:"tag.tag_name"}},[s._v(s._s(a.tag_name))]),s._v(" "),t("span",[s._v("/")])])})],2)],1)])})),s._v(" "),t("ul",{staticClass:"pager"},[t("li",{staticClass:"previous"},[t("router-link",{attrs:{to:"/"}},[s._v("← Newer Posts")])],1),s._v(" "),t("li",{staticClass:"next"},[t("router-link",{attrs:{to:"/page/1"}},[s._v("Older Posts →")])],1)])])},staticRenderFns:[]};var O=t("VU/8")(S,P,!1,function(s){t("/7JP")},null,null).exports;n.a.use(p.a);var A=new p.a({routes:[{path:"/",name:"index",component:m,meta:{keepAlive:!0}},{path:"/page/:id",name:"page",component:O,meta:{keepAlive:!0}},{path:"/tags",name:"tags",component:h,meta:{keepAlive:!0}},{path:"/tags/:name",name:"tags",component:h,meta:{keepAlive:!0}},{path:"/archive",name:"archive",component:k,meta:{keepAlive:!0}},{path:"/detail/:name",name:"detail",component:j,meta:{keepAlive:!0}},{path:"/about",name:"about",component:E,meta:{keepAlive:!0}}]});t("txPn"),n.a.config.productionTip=!1,n.a.directive("drag",{bind:function(s,a){var t=s;t.onmousedown=function(s){var n=s.clientX-t.offsetLeft,i=s.clientY-t.offsetTop;document.onmousemove=function(s){var e=s.clientX-n,l=s.clientY-i;t.style.left=e+"px",t.style.top=l+"px",a.value({x:s.pageX,y:s.pageY})},document.onmouseup=function(s){document.onmousemove=null,document.onmouseup=null}}}}),n.a.filter("getYMD",function(s){return s.split(" ")[0]}),new n.a({el:"#app",router:A,components:{App:_},template:"<App/>"})},c2Ch:function(s,a,t){"use strict";(function(s){var n=t("//Fk"),i=t.n(n),e=t("aozt"),l=t.n(e);function r(s,a){return new i.a(function(t,n){l.a.post(s,a).then(function(s){t(s)}).catch(function(s){n(s)})})}l.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",l.a.interceptors.request.use(function(s){return s},function(s){return i.a.reject(s)}),l.a.interceptors.response.use(function(a){var t=a.data;switch(t.code){case"000":return console.log(t),t;case"SHIRO_E5001":if(isWeChat()&&IS_PRODUCTION)l.a.get(apis.common.wechat.authorizeUrl).then(function(a){var t=a.result;location.replace(s.decodeURIComponent(t))});else{var n=encodeSearchParams({next:location.href});location.replace("/user/login?"+n)}t.description=""}var i=new Error(t.description);throw i.data=t,i.response=a,i},function(s){if(s&&s.response)switch(s.response.status){case 400:s.message="请求错误";break;case 401:s.message="未授权，请登录";break;case 403:s.message="拒绝访问";break;case 404:s.message="请求地址出错: "+s.response.config.url;break;case 408:s.message="请求超时";break;case 500:s.message="服务器内部错误";break;case 501:s.message="服务未实现";break;case 502:s.message="网关错误";break;case 503:s.message="服务不可用";break;case 504:s.message="网关超时";break;case 505:s.message="HTTP版本不受支持"}return i.a.reject(s)}),a.a={JH_news:function(s,a){return r(s,a)},post:function(s,a){return r(s,a)},get:function(s,a){return function(s,a){return new i.a(function(t,n){l.a.get(s,a).then(function(s){t(s)}).catch(function(s){n(s)})})}(s,a)}}}).call(a,t("DuR2"))},oPmM:function(s,a){},txPn:function(s,a,t){var n=t("cLQA"),i=n.Random;n.mock("/news/index","post",function(){for(var s=[],a=0;a<100;a++){var t={title:i.csentence(5,30),thumbnail_pic_s:i.dataImage("300x250","mock的图片"),author_name:i.cname(),date:i.date()+" "+i.time()};s.push(t)}return{articles:s}}),n.mock("/post/lists","get",function(){for(var s={code:"000",post_preview_lists:[]},a=0;a<8;a++){var t={post_info:i.csentence(5,30),tags:[{tag_name:i.cname()}],post_time:i.date()};s.post_preview_lists.push(t)}return s}),n.mock("/tags/lists","get",function(){for(var s={code:"000",tags:[],posts:{tag:"centos",post_preview_lists:[]}},a=0;a<8;a++){var t={tag_name:i.cname(3,10)};s.tags.push(t)}for(var n=0;n<10;n++){var e={post_info:i.csentence(5,30)};s.posts.post_preview_lists.push(e)}return s})},w5OA:function(s,a){}},["NHnr"]);
//# sourceMappingURL=app.435967518ca371f55d9a.js.map